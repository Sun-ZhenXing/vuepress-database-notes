<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/vuepress-database-notes/favicon.svg"><title>MySQL 学习笔记 | 数据库笔记合集</title><meta name="description" content="各种数据库和 SQL 笔记">
    <link rel="preload" href="/vuepress-database-notes/assets/style-kK_HitsF.css" as="style"><link rel="stylesheet" href="/vuepress-database-notes/assets/style-kK_HitsF.css">
    <link rel="modulepreload" href="/vuepress-database-notes/assets/app-Y4KcrCk8.js"><link rel="modulepreload" href="/vuepress-database-notes/assets/index.html-_hSx9S9S.js"><link rel="modulepreload" href="/vuepress-database-notes/assets/index.html-5245FXzm.js">
    <link rel="prefetch" href="/vuepress-database-notes/assets/index.html-3OMEh7v2.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/a.html-lD7h55Uu.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/b.html-hy0S0kJC.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/c.html-iJpLkQbB.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-2ufS3Bh-.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-_YftCcTW.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-pxsPIr8K.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-CF5vwdVE.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/q3c.html-J4NXWFbR.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-1NFdM7Pm.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/recursion.html-aAvaVmql.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/uuid.html-0jyQmfn9.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-ODvho95R.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/reset-password.html-Lhzvtkll.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-ZMZAFHjz.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/get-started.html-e8u7Cb1Y.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-l5PcTl_Y.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-K7Qv0dP6.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-5bw9J50K.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-ClpUd2jQ.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-_ytkL8Vd.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/404.html-_66Di_BG.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-u9V0Uhze.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/a.html-ot1fj7TR.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/b.html-taucG0JF.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/c.html-ouQoC29w.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-wS2Q25jA.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-lk2GbehY.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-poEdAidE.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-_mBbs8c0.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/q3c.html-hqAX-SgO.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-B3jV1wdd.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/recursion.html-p4c-XDB_.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/uuid.html-_P5H_Cvm.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-T3bcetav.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/reset-password.html-TwI_Qrb-.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-mpF-FhgY.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/get-started.html-WveeA4DV.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-fZoPZJWi.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-RYeeePer.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-Ovae02D8.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-ylBA5vk5.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/index.html-b5f3WfeB.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/404.html-jFhflaI7.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/mermaid.core-cVPmsejw.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/copy-tex.min-LXTknfyr.js" as="script"><link rel="prefetch" href="/vuepress-database-notes/assets/SearchResult-w106pXgT.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-database-notes/" class=""><img class="logo" src="/vuepress-database-notes/favicon.svg" alt="数据库笔记合集"><span class="site-name can-hide">数据库笔记合集</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-database-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-database-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">MySQL 学习笔记 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#1-mysql-基本操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. MySQL 基本操作"><!--[--><!--]--> 1. MySQL 基本操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#2-操作数据库的语句" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 操作数据库的语句"><!--[--><!--]--> 2. 操作数据库的语句 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#21-操作数据库" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 操作数据库"><!--[--><!--]--> 2.1 操作数据库 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#22-数据库的列类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 数据库的列类型"><!--[--><!--]--> 2.2 数据库的列类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#23-数据库的字段属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 数据库的字段属性"><!--[--><!--]--> 2.3 数据库的字段属性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#24-创建数据库表" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 创建数据库表"><!--[--><!--]--> 2.4 创建数据库表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#25-数据库引擎" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 数据库引擎"><!--[--><!--]--> 2.5 数据库引擎 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#26-修改和删除数据表" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6 修改和删除数据表"><!--[--><!--]--> 2.6 修改和删除数据表 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#3-mysql-的数据管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. MySQL 的数据管理"><!--[--><!--]--> 3. MySQL 的数据管理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#31-外键" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 外键"><!--[--><!--]--> 3.1 外键 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#32-dml-语言" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 DML 语言"><!--[--><!--]--> 3.2 DML 语言 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#4-dql-查询数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. DQL 查询数据"><!--[--><!--]--> 4. DQL 查询数据 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#41-基本查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 基本查询"><!--[--><!--]--> 4.1 基本查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#42-去重" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 去重"><!--[--><!--]--> 4.2 去重 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#43-where-条件子句" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 Where 条件子句"><!--[--><!--]--> 4.3 Where 条件子句 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#44-模糊查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 模糊查询"><!--[--><!--]--> 4.4 模糊查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#45-联表查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 联表查询"><!--[--><!--]--> 4.5 联表查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#46-自连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.6 自连接"><!--[--><!--]--> 4.6 自连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#47-分页和排序" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.7 分页和排序"><!--[--><!--]--> 4.7 分页和排序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#48-子查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.8 子查询"><!--[--><!--]--> 4.8 子查询 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#5-mysql-常用函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. MySQL 常用函数"><!--[--><!--]--> 5. MySQL 常用函数 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#51-常用函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 常用函数"><!--[--><!--]--> 5.1 常用函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#52-聚合函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 聚合函数"><!--[--><!--]--> 5.2 聚合函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#6-事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 事务"><!--[--><!--]--> 6. 事务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#7-索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. 索引"><!--[--><!--]--> 7. 索引 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#71-索引的分类" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 索引的分类"><!--[--><!--]--> 7.1 索引的分类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#72-索引的使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 索引的使用"><!--[--><!--]--> 7.2 索引的使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#73-测试索引性能" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 测试索引性能"><!--[--><!--]--> 7.3 测试索引性能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#74-索引原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4 索引原则"><!--[--><!--]--> 7.4 索引原则 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#8-权限管理和数据库备份" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. 权限管理和数据库备份"><!--[--><!--]--> 8. 权限管理和数据库备份 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#81-用户管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.1 用户管理"><!--[--><!--]--> 8.1 用户管理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#82-数据库备份" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.2 数据库备份"><!--[--><!--]--> 8.2 数据库备份 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#9-规范数据库设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="9. 规范数据库设计"><!--[--><!--]--> 9. 规范数据库设计 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#91-为什么设计数据库" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1 为什么设计数据库"><!--[--><!--]--> 9.1 为什么设计数据库 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#92-三大范式" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2 三大范式"><!--[--><!--]--> 9.2 三大范式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#10-jdbc" class="router-link-active router-link-exact-active sidebar-item" aria-label="10. JDBC"><!--[--><!--]--> 10. JDBC <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#101-数据库驱动" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.1 数据库驱动"><!--[--><!--]--> 10.1 数据库驱动 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#102-第一个-jdbc-程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.2 第一个 JDBC 程序"><!--[--><!--]--> 10.2 第一个 JDBC 程序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#103-封装-jdbc-连接" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.3 封装 JDBC 连接"><!--[--><!--]--> 10.3 封装 JDBC 连接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#104-解决-sql-注入问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.4 解决 SQL 注入问题"><!--[--><!--]--> 10.4 解决 SQL 注入问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#105-jdbc-事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.5 JDBC 事务"><!--[--><!--]--> 10.5 JDBC 事务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#106-数据库连接池" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.6 数据库连接池"><!--[--><!--]--> 10.6 数据库连接池 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#107-dbcp-连接池" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.7 DBCP 连接池"><!--[--><!--]--> 10.7 DBCP 连接池 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="mysql-学习笔记" tabindex="-1"><a class="header-anchor" href="#mysql-学习笔记" aria-hidden="true">#</a> MySQL 学习笔记</h1><p>本文是 <a href="https://www.bilibili.com/video/BV1NJ411J79W" target="_blank" rel="noopener noreferrer"><em>狂神说 Java：MySQL 最新教程通俗易懂</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> 的课程笔记。本文的 MySQL 学习是业务层面的 MySQL，运维级别的 MySQL 可以参考更多更深入的资料。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>作者的文档可以在微信公众号查看，<a href="http://mp.weixin.qq.com/mp/homepage?__biz=Mzg2NTAzMTExNg==&amp;hid=4&amp;sn=044c8767bd3c1825a329c2b98fff2ffe" target="_blank" rel="noopener noreferrer">作者的文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> 也可以参考。</p></div><nav class="table-of-contents"><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#1-mysql-基本操作" class="router-link-active router-link-exact-active">1. MySQL 基本操作</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#2-操作数据库的语句" class="router-link-active router-link-exact-active">2. 操作数据库的语句</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#21-操作数据库" class="router-link-active router-link-exact-active">2.1 操作数据库</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#22-数据库的列类型" class="router-link-active router-link-exact-active">2.2 数据库的列类型</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#23-数据库的字段属性" class="router-link-active router-link-exact-active">2.3 数据库的字段属性</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#24-创建数据库表" class="router-link-active router-link-exact-active">2.4 创建数据库表</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#25-数据库引擎" class="router-link-active router-link-exact-active">2.5 数据库引擎</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#26-修改和删除数据表" class="router-link-active router-link-exact-active">2.6 修改和删除数据表</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#3-mysql-的数据管理" class="router-link-active router-link-exact-active">3. MySQL 的数据管理</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#31-外键" class="router-link-active router-link-exact-active">3.1 外键</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#32-dml-语言" class="router-link-active router-link-exact-active">3.2 DML 语言</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#4-dql-查询数据" class="router-link-active router-link-exact-active">4. DQL 查询数据</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#41-基本查询" class="router-link-active router-link-exact-active">4.1 基本查询</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#42-去重" class="router-link-active router-link-exact-active">4.2 去重</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#43-where-条件子句" class="router-link-active router-link-exact-active">4.3 Where 条件子句</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#44-模糊查询" class="router-link-active router-link-exact-active">4.4 模糊查询</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#45-联表查询" class="router-link-active router-link-exact-active">4.5 联表查询</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#46-自连接" class="router-link-active router-link-exact-active">4.6 自连接</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#47-分页和排序" class="router-link-active router-link-exact-active">4.7 分页和排序</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#48-子查询" class="router-link-active router-link-exact-active">4.8 子查询</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#5-mysql-常用函数" class="router-link-active router-link-exact-active">5. MySQL 常用函数</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#51-常用函数" class="router-link-active router-link-exact-active">5.1 常用函数</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#52-聚合函数" class="router-link-active router-link-exact-active">5.2 聚合函数</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#6-事务" class="router-link-active router-link-exact-active">6. 事务</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#7-索引" class="router-link-active router-link-exact-active">7. 索引</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#71-索引的分类" class="router-link-active router-link-exact-active">7.1 索引的分类</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#72-索引的使用" class="router-link-active router-link-exact-active">7.2 索引的使用</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#73-测试索引性能" class="router-link-active router-link-exact-active">7.3 测试索引性能</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#74-索引原则" class="router-link-active router-link-exact-active">7.4 索引原则</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#8-权限管理和数据库备份" class="router-link-active router-link-exact-active">8. 权限管理和数据库备份</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#81-用户管理" class="router-link-active router-link-exact-active">8.1 用户管理</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#82-数据库备份" class="router-link-active router-link-exact-active">8.2 数据库备份</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#9-规范数据库设计" class="router-link-active router-link-exact-active">9. 规范数据库设计</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#91-为什么设计数据库" class="router-link-active router-link-exact-active">9.1 为什么设计数据库</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#92-三大范式" class="router-link-active router-link-exact-active">9.2 三大范式</a></li></ul></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#10-jdbc" class="router-link-active router-link-exact-active">10. JDBC</a><ul><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#101-数据库驱动" class="router-link-active router-link-exact-active">10.1 数据库驱动</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#102-第一个-jdbc-程序" class="router-link-active router-link-exact-active">10.2 第一个 JDBC 程序</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#103-封装-jdbc-连接" class="router-link-active router-link-exact-active">10.3 封装 JDBC 连接</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#104-解决-sql-注入问题" class="router-link-active router-link-exact-active">10.4 解决 SQL 注入问题</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#105-jdbc-事务" class="router-link-active router-link-exact-active">10.5 JDBC 事务</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#106-数据库连接池" class="router-link-active router-link-exact-active">10.6 数据库连接池</a></li><li><a aria-current="page" href="/vuepress-database-notes/mysql/basic/#107-dbcp-连接池" class="router-link-active router-link-exact-active">10.7 DBCP 连接池</a></li></ul></li></ul></nav><h2 id="1-mysql-基本操作" tabindex="-1"><a class="header-anchor" href="#1-mysql-基本操作" aria-hidden="true">#</a> 1. MySQL 基本操作</h2><p>在 Windows 上启动和关闭 MySQL 服务（需要管理员）：</p><div class="language-bat" data-ext="bat"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">net stop</span><span style="color:#D4D4D4;"> mysql</span></span>
<span class="line"><span style="color:#569CD6;">net start</span><span style="color:#D4D4D4;"> mysql</span></span>
<span class="line"></span></code></pre></div><p>登录 <code>root</code> 用户：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">mysql</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-u</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">root</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-p</span></span>
<span class="line"></span></code></pre></div><p>查询 MySQL 版本：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VERSION</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"></span></code></pre></div><p>刷新权限：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">FLUSH PRIVILEGES;</span></span>
<span class="line"></span></code></pre></div><p>修改密码：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> mysql.</span><span style="color:#CE9178;">`user`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SET</span></span>
<span class="line"><span style="color:#D4D4D4;">    authentication_string=</span><span style="color:#569CD6;">PASSWORD</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span></span>
<span class="line"><span style="color:#D4D4D4;">    user = </span><span style="color:#CE9178;">&#39;root&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AND</span><span style="color:#D4D4D4;"> host = </span><span style="color:#CE9178;">&#39;localhost&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查看数据库：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">SHOW DATABASES;</span></span>
<span class="line"></span></code></pre></div><p>使用数据库：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">USE</span><span style="color:#D4D4D4;"> world;</span></span>
<span class="line"></span></code></pre></div><p>查看数据库中的表的信息：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">SHOW TABLES;</span></span>
<span class="line"></span></code></pre></div><p>显示表的详细信息：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">DESCRIBE city;</span></span>
<span class="line"></span></code></pre></div><p>结束 MySQL 连接：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">exit</span></span>
<span class="line"></span></code></pre></div><p>MySQL 关键字不分大小写。</p><p>注释：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 单行注释</span></span>
<span class="line"><span style="color:#6A9955;">/*</span></span>
<span class="line"><span style="color:#6A9955;">    这是多行注释</span></span>
<span class="line"><span style="color:#6A9955;">*/</span></span>
<span class="line"><span style="color:#D4D4D4;"># MyQL 也支持使用 </span><span style="color:#CE9178;">&#39;#&#39;</span><span style="color:#D4D4D4;"> 注释</span></span>
<span class="line"></span></code></pre></div><p>创建数据表常规配置：</p><ul><li>引擎：<code>InnoDB</code></li><li>字符集：<code>utf8</code></li><li>排序：<code>utf8_general_ci</code></li></ul><h2 id="2-操作数据库的语句" tabindex="-1"><a class="header-anchor" href="#2-操作数据库的语句" aria-hidden="true">#</a> 2. 操作数据库的语句</h2><h3 id="21-操作数据库" tabindex="-1"><a class="header-anchor" href="#21-操作数据库" aria-hidden="true">#</a> 2.1 操作数据库</h3><p>MySQL 的数据库语言分为四大类：</p><ul><li>DDL：数据定义语言</li><li>DML：数据操作语言</li><li>DQL：数据查询语言</li><li>DCL：数据控制语言</li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><p>注意：下面的讲解中出现的 <code>[ ... ]</code> 表示可选内容，而 <code>{ ... }</code> 表示必选内容。</p></div><p>创建一个数据库，如果不存在的话：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NOT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`mydata`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>删除数据库：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`mydata`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>使用数据库：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">USE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`mydata`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查看数据库：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">SHOW DATABASES;</span></span>
<span class="line"></span></code></pre></div><h3 id="22-数据库的列类型" tabindex="-1"><a class="header-anchor" href="#22-数据库的列类型" aria-hidden="true">#</a> 2.2 数据库的列类型</h3><p>下面举例常见的类型：</p><table><thead><tr><th>数值类型</th><th>大小（字节）</th></tr></thead><tbody><tr><td><code>tinyint</code></td><td>1</td></tr><tr><td><code>smallint</code></td><td>2</td></tr><tr><td><code>mediumint</code></td><td>3</td></tr><tr><td><code>int</code></td><td>4</td></tr><tr><td><code>bigint</code></td><td>8</td></tr><tr><td><code>float</code></td><td>4</td></tr><tr><td><code>double</code></td><td>8</td></tr><tr><td><code>decimal</code></td><td>字符串形式</td></tr></tbody></table><table><thead><tr><th>字符类型</th><th>说明</th></tr></thead><tbody><tr><td><code>char</code></td><td>定长字符串，范围 0-255</td></tr><tr><td><code>varchar</code></td><td>变长字符串，范围 0-65535</td></tr><tr><td><code>tinytext</code></td><td>小文本，范围到 2^8-1</td></tr><tr><td><code>text</code></td><td>文本串，范围到 2^16-1</td></tr></tbody></table><table><thead><tr><th>日期</th><th>说明</th></tr></thead><tbody><tr><td><code>date</code></td><td>日期，格式为 <code>YYYY-MM-DD</code></td></tr><tr><td><code>time</code></td><td>时间，格式为 <code>HH:mm:ss</code></td></tr><tr><td><code>datetime</code></td><td>时间日期，格式为 <code>YYYY-MM-DD HH:mm:ss</code></td></tr><tr><td><code>timestamp</code></td><td>时间戳</td></tr><tr><td><code>year</code></td><td>年</td></tr></tbody></table><p><code>NULL</code> 类型为空值，如果需要比较请使用 <code>IS NULL</code> 而不是 <code>= NULL</code>，<code>NULL</code> 参与的运算结果也为 <code>NULL</code>。</p><h3 id="23-数据库的字段属性" tabindex="-1"><a class="header-anchor" href="#23-数据库的字段属性" aria-hidden="true">#</a> 2.3 数据库的字段属性</h3><table><thead><tr><th>字段属性</th><th>含义</th></tr></thead><tbody><tr><td><code>UNSIGNED</code></td><td>无符号的</td></tr><tr><td><code>ZEROFILL</code></td><td>零填充位数</td></tr><tr><td><code>AUTO_INCREMENT</code></td><td>自增的</td></tr><tr><td><code>NOT NULL</code></td><td>是否可空</td></tr><tr><td><code>DEFAULT</code></td><td>默认值</td></tr><tr><td><code>COMMENT</code></td><td>注释，可选</td></tr></tbody></table><p>PS：一个业务型数据库必须存在的一些字段。</p><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td><code>id</code></td><td>一般是主键</td></tr><tr><td><code>version</code></td><td>乐观锁</td></tr><tr><td><code>is_delete</code></td><td>伪删除</td></tr><tr><td><code>gmt_create</code></td><td>创建时间</td></tr><tr><td><code>gmt_update</code></td><td>修改时间</td></tr></tbody></table><h3 id="24-创建数据库表" tabindex="-1"><a class="header-anchor" href="#24-创建数据库表" aria-hidden="true">#</a> 2.4 创建数据库表</h3><p>建表语法：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> [IF NOT EXISTS] </span><span style="color:#CE9178;">`表名`</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`字段名`</span><span style="color:#D4D4D4;"> 列类型 [属性] [索引] [注释],</span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"><span style="color:#D4D4D4;">) [引擎] [字符集] [注释];</span></span>
<span class="line"></span></code></pre></div><p>下面是实例：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NOT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> AUTO_INCREMENT COMMENT </span><span style="color:#CE9178;">&#39;学号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;匿名&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;姓名&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`pwd`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;密码&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`sex`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;女&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;性别&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`birthday`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATETIME</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;出生日期&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`address`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;家庭住址&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;邮箱&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE=INNODB </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET=utf8;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>规则：</p><ol><li>表的名称和字段名尽量使用反引号括起来</li><li>字符串尽量只使用单引号</li><li>每一行加上一个逗号（<code>,</code>），最后一行可以不加</li><li>一个表只有唯一的主键，可以写在语句最后</li><li>数据库不使用驼峰命名，一般是小写字母和下划线分割，首字母可以大写</li></ol><p>如果需要查看表的具体结构，可以使用：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 查看表的结构</span></span>
<span class="line"><span style="color:#569CD6;">DESC</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"><span style="color:#6A9955;">-- 或者使用</span></span>
<span class="line"><span style="color:#D4D4D4;">DESCRIBE student;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 查看创建数据库的语句</span></span>
<span class="line"><span style="color:#D4D4D4;">SHOW </span><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> school;</span></span>
<span class="line"><span style="color:#6A9955;">-- 查看建表语句</span></span>
<span class="line"><span style="color:#D4D4D4;">SHOW </span><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>如果字符集有问题，可以设置默认字符集，在 <code>my.ini</code> 文件中修改：</p><div class="language-ini" data-ext="ini"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">character-set-server</span><span style="color:#D4D4D4;">=utf8</span></span>
<span class="line"></span></code></pre></div><h3 id="25-数据库引擎" tabindex="-1"><a class="header-anchor" href="#25-数据库引擎" aria-hidden="true">#</a> 2.5 数据库引擎</h3><p>常用的有：</p><ul><li>InnoDB</li><li>MyISAM</li></ul><table><thead><tr><th>特点</th><th>MyISAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>事务支持</td><td>不支持</td><td>支持</td></tr><tr><td>数据行锁定</td><td>不支持</td><td>支持</td></tr><tr><td>外键约束</td><td>不支持</td><td>支持</td></tr><tr><td>全文索引</td><td>支持</td><td>不支持</td></tr><tr><td>表空间大小</td><td>较小</td><td>约为 InnoDB 的两倍</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">提示</p><p>最新版的 MyISAM 也支持事务。</p></div><p>比较特点：</p><ul><li>InnoDB：安全性高，事务处理，多表多用户操作</li><li>MyISAM：节约空间，速度较快</li></ul><p>MySQL 的数据库信息储存在 <code>data</code> 目录下，本质还是文件存储。</p><p>数据库引擎在物理文件上的区别：</p><ul><li>InnoDB：表结构文件 <code>*.frm</code> 和上一级的 <code>ibdata*</code> 文件</li><li>MyISAM：表结构文件 <code>*.frm</code> 和数据文件 <code>*.MYD</code>、<code>*.MYI</code> 索引文件</li></ul><h3 id="26-修改和删除数据表" tabindex="-1"><a class="header-anchor" href="#26-修改和删除数据表" aria-hidden="true">#</a> 2.6 修改和删除数据表</h3><p>修改表的名称：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student RENAME student1;</span></span>
<span class="line"></span></code></pre></div><p>增加表的字段：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">ADD</span><span style="color:#D4D4D4;"> age </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>修改表的字段约束：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">MODIFY</span><span style="color:#D4D4D4;"> age </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>修改表的字段名：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student CHANGE age age1 </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><blockquote><p><code>MODIFY</code> 和 <code>CHANGE</code> 的区别：</p><ul><li><code>MODIFY</code> 不能来重命名，只能修改字段类型和约束</li><li><code>CHANGE</code> 可以用来重命名字段，但是不能修改字段类型和约束</li></ul></blockquote><p>删除表的字段：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> age1;</span></span>
<span class="line"></span></code></pre></div><p>删除表，如果表存在的话：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>创建的删除操作尽量加上 <code>IF EXISTS</code> 防止报错。</p></blockquote><h2 id="3-mysql-的数据管理" tabindex="-1"><a class="header-anchor" href="#3-mysql-的数据管理" aria-hidden="true">#</a> 3. MySQL 的数据管理</h2><h3 id="31-外键" tabindex="-1"><a class="header-anchor" href="#31-外键" aria-hidden="true">#</a> 3.1 外键</h3><blockquote><p>删除有外键的表，必须要先删除引用的表。</p></blockquote><p>我们可以让我们的学生表加入年级 <code>gradeid</code> 字段，然后年级字段引用年级表的 <code>gradeid</code> 字段，我们的年级表定义如下：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">grade</span><span style="color:#D4D4D4;">` (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> AUTO_INCREMENT COMMENT </span><span style="color:#CE9178;">&#39;年级ID&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradename`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;年级名称&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE=INNODB </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET=utf8;</span></span>
<span class="line"></span></code></pre></div><p>下面我们给学生表增加约束，简单起见，我们重新建表：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NOT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> AUTO_INCREMENT COMMENT </span><span style="color:#CE9178;">&#39;学号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;匿名&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;姓名&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`pwd`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;密码&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`sex`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;女&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;性别&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`birthday`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATETIME</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;出生日期&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;年级ID&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`address`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;家庭住址&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;邮箱&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">KEY</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`FK_gradeid`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">CONSTRAINT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`FK_gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FOREIGN KEY</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">REFERENCES</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE=INNODB </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET=utf8;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是一种方式，给表手动加上约束。</p><p>或者通过修改的方式给表增加外键：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ADD</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">CONSTRAINT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`FK_gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FOREIGN KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">REFERENCES</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>以上的外键都是数据库级别的外键，不建议使用。（避免数据库过多造成困扰）最佳实践是将数据库视为单纯的表，只用来储存数据，而外键使用程序实现。</p></div><h3 id="32-dml-语言" tabindex="-1"><a class="header-anchor" href="#32-dml-语言" aria-hidden="true">#</a> 3.2 DML 语言</h3><p>数据库的意义：数据存储，数据管理。</p><p>DML 语言：数据操作语言。分别对应下面几个方法：</p><ul><li><code>INSERT</code></li><li><code>UPDATE</code></li><li><code>DELETE</code></li></ul><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradename`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">&#39;大四&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>如果不写表的字段，那么将会一一匹配：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;大一&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>插入多个值：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradename`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">VALUES</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#CE9178;">&#39;大二&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#CE9178;">&#39;大三&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>更新值：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;鸭梨&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>可以修改多个属性：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SET</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;鸭梨&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;alex@alexsun.top&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>操作符</th><th>含义</th></tr></thead><tbody><tr><td><code>=</code></td><td>等于</td></tr><tr><td><code>&lt;&gt;</code> 或 <code>!=</code></td><td>等于</td></tr><tr><td><code>BETWEEN ... AND ...</code></td><td>在范围内</td></tr><tr><td><code>&gt;</code>、<code>&lt;</code>、<code>&gt;=</code>、<code>&lt;=</code></td><td>大于小于……</td></tr><tr><td><code>AND</code></td><td>且</td></tr><tr><td><code>OR</code></td><td>或</td></tr><tr><td><code>NOT</code></td><td>否定</td></tr></tbody></table><p>删除数据：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">DELETE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>清空一张表，但保留结构：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">TRUNCATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span></span>
<span class="line"></span></code></pre></div><p>区别：</p><ul><li><code>TRUNCATE</code> 会将计数器清零</li><li><code>TRUNCATE</code> 不会影响事务的执行</li></ul><p><code>DELETE</code> 问题，当重启数据库时：</p><ul><li>对于 InnoDB，自增会从 1 开始，因为这个值存在内存中</li><li>对于 MyISAM，自增不变，这个值存在于磁盘中</li></ul><h2 id="4-dql-查询数据" tabindex="-1"><a class="header-anchor" href="#4-dql-查询数据" aria-hidden="true">#</a> 4. DQL 查询数据</h2><p>DQL（Data Query Language），即数据查询语言：</p><ul><li>数据库最核心的语言</li><li>所以的查询都使用 <code>SELECT</code> 来查询</li><li>简单和复杂的查询都能写</li><li>是使用频率最高的语句</li></ul><p>下面是本节使用的数据和表：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">create</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">database</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">exists</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`school`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">use</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`school`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 创建学生表</span></span>
<span class="line"><span style="color:#569CD6;">drop</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">exists</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">create</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">student</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`studentno`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;学号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`loginpwd`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`studentname`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;学生姓名&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`sex`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">tinyint</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;性别，0或1&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;年级编号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`phone`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;联系电话，允许为空&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`address`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;地址，允许为空&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`borndate`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">datetime</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;出生时间&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;邮箱账号允许为空&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`identitycard`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">18</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;身份证号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">primary key</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`studentno`</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">unique</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">key</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`identitycard`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`identitycard`</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">key</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) engine=myisam </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> charset=utf8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 创建年级表</span></span>
<span class="line"><span style="color:#569CD6;">drop</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">exists</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">create</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">grade</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> auto_increment comment </span><span style="color:#CE9178;">&#39;年级编号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradename`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;年级名称&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">primary key</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) engine=innodb auto_increment = </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> charset = utf8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 创建科目表</span></span>
<span class="line"><span style="color:#569CD6;">drop</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">exists</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">create</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">subject</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`subjectno`</span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> auto_increment comment </span><span style="color:#CE9178;">&#39;课程编号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`subjectname`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">varchar</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;课程名称&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`classhour`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;学时&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;年级编号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">primary key</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) engine = innodb auto_increment = </span><span style="color:#B5CEA8;">19</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> charset = utf8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 创建成绩表</span></span>
<span class="line"><span style="color:#569CD6;">drop</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">exists</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`result`</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">create</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">result</span><span style="color:#D4D4D4;">`(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`studentno`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;学号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;课程编号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`examdate`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">datetime</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;考试日期&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`studentresult`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">int</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">not null</span><span style="color:#D4D4D4;"> comment </span><span style="color:#CE9178;">&#39;考试成绩&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">key</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) engine = innodb </span><span style="color:#569CD6;">default</span><span style="color:#D4D4D4;"> charset = utf8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 插入学生数据</span></span>
<span class="line"><span style="color:#569CD6;">insert into</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`student`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`studentno`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`loginpwd`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`studentname`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`sex`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`phone`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`address`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`borndate`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`identitycard`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">values</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;张伟&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;13800001234&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;北京朝阳&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1980-1-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;text123@qq.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;123456198001011234&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1001</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;赵强&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;13800002222&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;广东深圳&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1990-1-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;text111@qq.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;123456199001011233&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 插入成绩数据</span></span>
<span class="line"><span style="color:#569CD6;">insert into</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`result`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`studentno`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`examdate`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`studentresult`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">values</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;2013-11-11 16:00:00&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">85</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;2013-11-12 16:00:00&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">70</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;2013-11-11 09:00:00&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">68</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;2013-11-13 16:00:00&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">98</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;2013-11-14 16:00:00&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">58</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 插入年级数据</span></span>
<span class="line"><span style="color:#569CD6;">insert into</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`grade`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`gradename`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">values</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;大一&#39;</span><span style="color:#D4D4D4;">), (</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;大二&#39;</span><span style="color:#D4D4D4;">), (</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;大三&#39;</span><span style="color:#D4D4D4;">), (</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;大四&#39;</span><span style="color:#D4D4D4;">), (</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;预科班&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 插入科目数据</span></span>
<span class="line"><span style="color:#569CD6;">insert into</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`subjectno`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`subjectname`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`classhour`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`gradeid`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">values</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;高等数学-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;高等数学-2&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;高等数学-3&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;高等数学-4&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">130</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;C语言-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;C语言-2&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;C语言-3&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">8</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;C语言-4&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">130</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;Java程序设计-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;Java程序设计-2&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;Java程序设计-3&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;Java程序设计-4&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">130</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">13</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;数据库结构-1&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">14</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;数据库结构-2&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">110</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;数据库结构-3&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;数据库结构-4&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">130</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">17</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;C#基础&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">130</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的数据仅为示例，可以根据实际情况生成或者 Mock。</p><h3 id="41-基本查询" tabindex="-1"><a class="header-anchor" href="#41-基本查询" aria-hidden="true">#</a> 4.1 基本查询</h3><p>查询所有字段：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>查询指定字段，并使用别名（别名可以加引号，也可以不加）：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;学号&#39;</span><span style="color:#D4D4D4;">, studentname </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;学生姓名&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>查询被连接的字符串：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">CONCAT</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;姓名：&#39;</span><span style="color:#D4D4D4;">, studentname) </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> 新名字 </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>新名字</th></tr></thead><tbody><tr><td>姓名：张伟</td></tr><tr><td>姓名：赵强</td></tr></tbody></table><h3 id="42-去重" tabindex="-1"><a class="header-anchor" href="#42-去重" aria-hidden="true">#</a> 4.2 去重</h3><p>对结果去重：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT DISTINCT</span><span style="color:#D4D4D4;"> studentno </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result;</span></span>
<span class="line"></span></code></pre></div><p>SQL 也可以直接查询表达式：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> RES</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>RES</th></tr></thead><tbody><tr><td>300</td></tr></tbody></table><p>查询自增的步长：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> @@auto_increment_increment;</span></span>
<span class="line"></span></code></pre></div><p><code>SELECT</code> 可以选择的表达式包括：</p><ul><li>文本</li><li>列</li><li><code>NULL</code></li><li>函数</li><li>计算表达式</li><li>系统遍历</li></ul><h3 id="43-where-条件子句" tabindex="-1"><a class="header-anchor" href="#43-where-条件子句" aria-hidden="true">#</a> 4.3 Where 条件子句</h3><p>查询成绩在 95~100 分的人：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> studentresult </span><span style="color:#569CD6;">BETWEEN</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">95</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AND</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查询不是 1000 号学生的成绩：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NOT</span><span style="color:#D4D4D4;"> studentno = </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="44-模糊查询" tabindex="-1"><a class="header-anchor" href="#44-模糊查询" aria-hidden="true">#</a> 4.4 模糊查询</h3><table><thead><tr><th>运算符</th><th>描述</th></tr></thead><tbody><tr><td><code>IS NULL</code></td><td>为空</td></tr><tr><td><code>IS NOT NULL</code></td><td>非空</td></tr><tr><td><code>LIKE</code></td><td>匹配</td></tr><tr><td><code>IN</code></td><td>在集合内</td></tr></tbody></table><p>模糊查询中的 <code>%</code> 相当于任意字符，相当于通配符 <code>*</code>，<code>_</code> 匹配一个字符，相当于通配符 <code>?</code>。</p><p>查询张姓同学：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, studentname </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> studentname </span><span style="color:#569CD6;">LIKE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;张%&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查询学号在指定范围内的学生：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, studentname </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> studentno </span><span style="color:#569CD6;">IN</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1023</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1345</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><h3 id="45-联表查询" tabindex="-1"><a class="header-anchor" href="#45-联表查询" aria-hidden="true">#</a> 4.5 联表查询</h3><p>查询参见了考试的同学（学号，姓名，科目，分数）</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno, studentname, subjectno, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> s </span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.studentno = r.studentno;</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>操作</th><th>描述</th></tr></thead><tbody><tr><td><code>inner join</code></td><td>如果有一个匹配就返回行</td></tr><tr><td><code>left join</code></td><td>从左表返回所有的值，即使右表没有匹配</td></tr><tr><td><code>right join</code></td><td>从右表返回所有的值，即使左表没有匹配</td></tr></tbody></table><p>查询缺考的同学：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno, studentname, subjectno, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> s</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">LEFT JOIN</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.studentno = r.studentno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> studentresult </span><span style="color:#569CD6;">IS</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查询参加考试的同学的信息（学号，学生姓名，科目，分数）：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno, studentname, subjectname, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> s</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">RIGHT JOIN</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.studentno = s.studentno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.subjectno = sub.subjectno</span></span>
<span class="line"></span></code></pre></div><p>分析思路：</p><ol><li>分析需求，分析查询的字段来自哪些表 <ul><li>从哪些表查询数据</li><li>如果存在多张表的查询，先从两张表的查询开始</li></ul></li><li>确定使用哪种连接查询 <ul><li>判断交叉点（是 7 种中的哪一种）</li><li>判断条件</li></ul></li></ol><p>查询学生所属的年级：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, studentname, gradename</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> grade</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> student.gradeid = grade.gradeid;</span></span>
<span class="line"></span></code></pre></div><p>查询科目所属的年级：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> subjectno, subjectname, gradename</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> grade</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> grade.gradeid = </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;">.gradeid;</span></span>
<span class="line"></span></code></pre></div><p>查询参加了 “高等数学-4” 考试的同学信息（学号，学生姓名，科目名，分数）：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno, studentname, subjectname, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> s</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`result`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.studentno = r.studentno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.subjectno = sub.subjectno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;数据库结构-1&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="46-自连接" tabindex="-1"><a class="header-anchor" href="#46-自连接" aria-hidden="true">#</a> 4.6 自连接</h3><p>自连接即自己的表的自己的表连接，逻辑上将一张表拆为两张一样的表。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">category</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`categoryid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">) UNSIGNED </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> AUTO_INCREMENT COMMENT </span><span style="color:#CE9178;">&#39;主题ID&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`pid`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;父ID&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`categoryName`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;主题名字&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`categoryid`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE=INNODB AUTO_INCREMENT=</span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET=utf8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`category`</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`categoryid`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`pid`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`categoryName`</span><span style="color:#D4D4D4;">) </span></span>
<span class="line"><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;">  (</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;信息技术&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;软件开发&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;数据库&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;美术设计&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;web开发&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;ps技术&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">        (</span><span style="color:#B5CEA8;">8</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;办公信息&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们将上面的表分割为上面的两张表：</p><table><thead><tr><th><code>categoryid</code></th><th><code>categoryName</code></th></tr></thead><tbody><tr><td>2</td><td>信息技术</td></tr><tr><td>3</td><td>软件开发</td></tr><tr><td>5</td><td>美术设计</td></tr></tbody></table><table><thead><tr><th><code>pid</code></th><th><code>categoryid</code></th><th><code>categoryName</code></th></tr></thead><tbody><tr><td>3</td><td>4</td><td>数据库</td></tr><tr><td>2</td><td>8</td><td>办公信息</td></tr><tr><td>3</td><td>6</td><td>web开发</td></tr><tr><td>5</td><td>7</td><td>美术设计</td></tr></tbody></table><p>查询预期：</p><table><thead><tr><th>父栏目</th><th>子栏目</th></tr></thead><tbody><tr><td>软件开发</td><td>数据库</td></tr><tr><td>软件开发</td><td>web开发</td></tr><tr><td>美术设计</td><td>ps技术</td></tr><tr><td>信息技术</td><td>办公信息</td></tr></tbody></table><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> a.categoryName </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;父栏目&#39;</span><span style="color:#D4D4D4;">, b.categoryName </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;子栏目&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> category </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> a, category </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> b</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> a.categoryid = b.pid;</span></span>
<span class="line"></span></code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p><a href="https://leetcode.cn/problems/employees-earning-more-than-their-managers/" target="_blank" rel="noopener noreferrer">LeetCode：181. 超过经理收入的员工<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><p>此题可以使用自连接实现，参考代码：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">select</span><span style="color:#D4D4D4;"> E1.name </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> Employee </span><span style="color:#569CD6;">from</span><span style="color:#D4D4D4;"> Employee </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> E1</span></span>
<span class="line"><span style="color:#569CD6;">left join</span><span style="color:#D4D4D4;"> Employee </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> E2</span></span>
<span class="line"><span style="color:#569CD6;">on</span><span style="color:#D4D4D4;"> E1.managerId = E2.id</span></span>
<span class="line"><span style="color:#569CD6;">where</span><span style="color:#D4D4D4;"> E1.salary &gt; E2.salary;</span></span>
<span class="line"></span></code></pre></div></div><h3 id="47-分页和排序" tabindex="-1"><a class="header-anchor" href="#47-分页和排序" aria-hidden="true">#</a> 4.7 分页和排序</h3><p>SQL <code>SELECT</code> 完整语法如下，其中各个子句的位置不能调换：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">select</span><span style="color:#D4D4D4;"> [all|distinct]</span></span>
<span class="line"><span style="color:#D4D4D4;">{*|</span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;">.*|[table.]field[as alias],...}</span></span>
<span class="line"><span style="color:#569CD6;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">table</span><span style="color:#D4D4D4;">[as table_alias], ...</span></span>
<span class="line"><span style="color:#D4D4D4;">    [left|right|inner join table2]</span></span>
<span class="line"><span style="color:#D4D4D4;">    [where ...]</span></span>
<span class="line"><span style="color:#D4D4D4;">    [group by ...]</span></span>
<span class="line"><span style="color:#D4D4D4;">    [having ...]</span></span>
<span class="line"><span style="color:#D4D4D4;">    [order by ...]</span></span>
<span class="line"><span style="color:#D4D4D4;">    [limit ]</span></span>
<span class="line"></span></code></pre></div><p>排序：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ORDER BY</span><span style="color:#D4D4D4;"> studentresult </span><span style="color:#569CD6;">DESC</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>升序使用 <code>ASC</code>，降序使用 <code>DESC</code>，可以支持多个键进行排序。</p><p>查询 “高等数学-1” 课程成绩排名前十的学生，并且分数大于 80 分的学生信息（学号，姓名，课程名称，分数）：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno, s.studentname, sub.subjectname, r.studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> s</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.studentno = s.studentno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> sub.subjectno = r.subjectno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> sub.subjectname = </span><span style="color:#CE9178;">&#39;高等数学-1&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">LIMIT</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="48-子查询" tabindex="-1"><a class="header-anchor" href="#48-子查询" aria-hidden="true">#</a> 4.8 子查询</h3><p>查询 “高等数学-4” 的所有考试结果（学科，科目编号，成绩），降序排列。</p><p>【方式一】使用连接查询</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, r.subjectno, studentresult</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.subjectno = sub.subjectno</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;高等数学-4&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ORDER BY</span><span style="color:#D4D4D4;"> studentresult </span><span style="color:#569CD6;">DESC</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>【方式二】使用子查询</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno, subjectno, studentresult</span></span>
<span class="line"><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectno = (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> subjectno </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;高等数学-4&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#569CD6;">ORDER BY</span><span style="color:#D4D4D4;"> studentresult </span><span style="color:#569CD6;">DESC</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查询课程为 “高等数学-2” 且分数不小于 80 分的学生的学号和姓名：</p><p>【方法一】使用连接查询</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> s.studentno,studentname</span></span>
<span class="line"><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student s</span></span>
<span class="line"><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> result r</span></span>
<span class="line"><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.</span><span style="color:#CE9178;">`StudentNo`</span><span style="color:#D4D4D4;"> = r.</span><span style="color:#CE9178;">`StudentNo`</span></span>
<span class="line"><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> sub.</span><span style="color:#CE9178;">`SubjectNo`</span><span style="color:#D4D4D4;"> = r.</span><span style="color:#CE9178;">`SubjectNo`</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;高等数学-2&#39;</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AND</span><span style="color:#D4D4D4;"> StudentResult &gt;= </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>【方法二】使用连接查询 + 子查询</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> r.studentno,studentname </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student s</span></span>
<span class="line"><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> result r </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.</span><span style="color:#CE9178;">`StudentNo`</span><span style="color:#D4D4D4;">=r.</span><span style="color:#CE9178;">`StudentNo`</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> StudentResult&gt;=</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 在上面 SQL 基础上，添加需求：课程为 高等数学-2</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> r.studentno,studentname </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student s</span></span>
<span class="line"><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> result r </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> s.</span><span style="color:#CE9178;">`StudentNo`</span><span style="color:#D4D4D4;">=r.</span><span style="color:#CE9178;">`StudentNo`</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> StudentResult &gt;=</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AND</span><span style="color:#D4D4D4;"> subjectno=(</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> subjectno </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;高等数学-2&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【方法三】使用子查询</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno,studentname </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> studentno </span><span style="color:#569CD6;">IN</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> studentno </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> StudentResult &gt;=</span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">AND</span><span style="color:#D4D4D4;"> subjectno = (</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> subjectno </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> subjectname = </span><span style="color:#CE9178;">&#39;高等数学-2&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p><a href="https://leetcode.cn/problems/second-highest-salary/" target="_blank" rel="noopener noreferrer">LeetCode：176. 第二高的薪水<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><p>此题可以使用子查询，参考代码：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">select</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">max</span><span style="color:#D4D4D4;">(salary) </span><span style="color:#569CD6;">as</span><span style="color:#D4D4D4;"> SecondHighestSalary </span><span style="color:#569CD6;">from</span><span style="color:#D4D4D4;"> Employee</span></span>
<span class="line"><span style="color:#569CD6;">where</span><span style="color:#D4D4D4;"> salary &lt; (</span><span style="color:#569CD6;">select</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">max</span><span style="color:#D4D4D4;">(salary) </span><span style="color:#569CD6;">from</span><span style="color:#D4D4D4;"> Employee);</span></span>
<span class="line"></span></code></pre></div></div><h2 id="5-mysql-常用函数" tabindex="-1"><a class="header-anchor" href="#5-mysql-常用函数" aria-hidden="true">#</a> 5. MySQL 常用函数</h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>参考文档：<a href="https://dev.mysql.com/doc/refman/8.0/en/built-in-function-reference.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/built-in-function-reference.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></div><h3 id="51-常用函数" tabindex="-1"><a class="header-anchor" href="#51-常用函数" aria-hidden="true">#</a> 5.1 常用函数</h3><p>几乎各种语言常用的数学运算都存在：</p><ul><li><code>ABS(X)</code></li><li><code>RAND()</code></li><li><code>SIN(X)</code></li><li><code>CEIL(X)</code></li></ul><p>还有字符串函数：</p><ul><li><code>CHAR_LENGTH(&#39;123&#39;)</code> 获得字符串的长度</li><li><code>CONCAT(s1, s2)</code> 拼接字符串</li><li><code>INSERT(str, pos, len, newstr)</code> 插入字符串</li><li><code>UPPER(&#39;1231wqwerqwe&#39;)</code> 转换为大写</li><li><code>REPLACE(&#39;123456&#39;,&#39;34&#39;,&#39;abc&#39;)</code> 替换字符串</li></ul><p>时间日期的函数：</p><ul><li><code>CURRENT_DATE()</code> 当前日期</li><li><code>CURDATE()</code> 和上面的函数一样</li><li><code>LOCALTIME()</code> 本地时间日期</li><li><code>NOW()</code> 当前时间日期</li><li><code>SYSDATE()</code> 系统时间</li></ul><p>查询当前的日期信息：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">YEAR</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">MONTH</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">DAY</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">HOUR</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">MINUTE</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SECOND</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"></span></code></pre></div><p>MySQL 支持签名算法：</p><ul><li><code>MD5(str)</code></li><li><code>SHA(str)</code></li></ul><p>系统函数：</p><ul><li><code>USER()</code> 当前用户</li><li><code>SYSTEM_USER()</code> 用户名，和上面结果一致</li><li><code>VERSION()</code> MySQL 版本</li></ul><h3 id="52-聚合函数" tabindex="-1"><a class="header-anchor" href="#52-聚合函数" aria-hidden="true">#</a> 5.2 聚合函数</h3><table><thead><tr><th>函数名</th><th>描述</th></tr></thead><tbody><tr><td><code>COUNT()</code></td><td>计数</td></tr><tr><td><code>SUM()</code></td><td>求和</td></tr><tr><td><code>AVG()</code></td><td>平均数</td></tr><tr><td><code>MIN()</code></td><td>最小值</td></tr><tr><td><code>MAX()</code></td><td>最大值</td></tr></tbody></table><p>查询一共有多少学生：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 指定列，会忽略 null</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">COUNT</span><span style="color:#D4D4D4;">(studentno) </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"><span style="color:#6A9955;">-- 每一条记录</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">COUNT</span><span style="color:#D4D4D4;">(*) </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"><span style="color:#6A9955;">-- </span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">COUNT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>查询平均分大于 80 分的课程的平均分、最高分、最低分：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> subjectname, </span><span style="color:#DCDCAA;">AVG</span><span style="color:#D4D4D4;">(studentresult), </span><span style="color:#DCDCAA;">MAX</span><span style="color:#D4D4D4;">(studentresult), </span><span style="color:#DCDCAA;">MIN</span><span style="color:#D4D4D4;">(studentresult)</span></span>
<span class="line"><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">AS</span><span style="color:#D4D4D4;"> r</span></span>
<span class="line"><span style="color:#569CD6;">INNER JOIN</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`subject`</span><span style="color:#D4D4D4;"> sub</span></span>
<span class="line"><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> r.subjectno = sub.subjectno</span></span>
<span class="line"><span style="color:#569CD6;">GROUP BY</span><span style="color:#D4D4D4;"> r.subjectno</span></span>
<span class="line"><span style="color:#569CD6;">HAVING</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">AVG</span><span style="color:#D4D4D4;">(studentresult) &gt; </span><span style="color:#B5CEA8;">80</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p><code>HAVING</code> 用于过滤分组信息。</p><h2 id="6-事务" tabindex="-1"><a class="header-anchor" href="#6-事务" aria-hidden="true">#</a> 6. 事务</h2><p>事务：批量的操作，要么都成功，要么都失败。</p><p>事务原则：ACID 原则</p><ul><li>原子性</li><li>一致性</li><li>隔离性</li><li>持久性</li></ul><p>隔离性的问题：</p><ul><li>脏读：一个事务提交了，但另一个没有提交</li><li>不可重复读：同一个事务内，重复读取表中的数据，表数据发生了改变</li><li>虚读（幻读）：在一个事务中读到了别人插入的数据，导致前后结果不一致</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 关闭自动提交</span></span>
<span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> autocommit = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">-- 开始事务</span></span>
<span class="line"><span style="color:#569CD6;">START TRANSACTION</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">1001</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">(), </span><span style="color:#B5CEA8;">90</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 可以记录保存点</span></span>
<span class="line"><span style="color:#D4D4D4;">SAVEPOINT 保存点;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> result </span><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;"> (</span><span style="color:#B5CEA8;">1001</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">NOW</span><span style="color:#D4D4D4;">(), </span><span style="color:#B5CEA8;">95</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 提交事务</span></span>
<span class="line"><span style="color:#569CD6;">COMMIT</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">-- 开启自动提交</span></span>
<span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> autocommit = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>回滚到指定保存点语法：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ROLLBACK</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TO</span><span style="color:#D4D4D4;"> SAVEPOINT 保存点名称;</span></span>
<span class="line"></span></code></pre></div><p>删除一个保存点：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">RELEASE SAVEPOINT 保存点名;</span></span>
<span class="line"></span></code></pre></div><p>下面创建一个数据库模拟转账问题：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">shop</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">CHARACTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> utf8 </span><span style="color:#569CD6;">COLLATE</span><span style="color:#D4D4D4;"> utf8_general_ci;</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">account</span><span style="color:#D4D4D4;">` (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> auto_increment,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`money`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DECIMAL</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE=INNODB </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET=utf8;</span></span>
<span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> account (</span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`money`</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">VALUES</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#CE9178;">&#39;A&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2000</span><span style="color:#D4D4D4;">.</span><span style="color:#B5CEA8;">00</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#CE9178;">&#39;B&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10000</span><span style="color:#D4D4D4;">.</span><span style="color:#B5CEA8;">00</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面模拟转账事务：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> autocommit = </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">START TRANSACTION</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> account </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">money</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">money</span><span style="color:#D4D4D4;">-</span><span style="color:#B5CEA8;">500</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;A&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> account </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">money</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">money</span><span style="color:#D4D4D4;">+</span><span style="color:#B5CEA8;">500</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;B&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">COMMIT</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> autocommit = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="7-索引" tabindex="-1"><a class="header-anchor" href="#7-索引" aria-hidden="true">#</a> 7. 索引</h2><blockquote><p>索引是帮助 MySQL 高效获取数据的数据结构。</p></blockquote><h3 id="71-索引的分类" tabindex="-1"><a class="header-anchor" href="#71-索引的分类" aria-hidden="true">#</a> 7.1 索引的分类</h3><p>下面列举一些常见的索引：</p><ul><li>主键索引（Primary Key） <ul><li>唯一标识</li><li>主键只有一个</li></ul></li><li>唯一索引（Unique Key） <ul><li>避免重复的列出现</li><li>可以有多个列加入唯一索引</li></ul></li><li>常规索引（Key / Index） <ul><li>默认的</li></ul></li><li>全文索引（FullText） <ul><li>在特定的数据库引擎下才有</li></ul></li></ul><h3 id="72-索引的使用" tabindex="-1"><a class="header-anchor" href="#72-索引的使用" aria-hidden="true">#</a> 7.2 索引的使用</h3><p>索引使用步骤：</p><ol><li>创建表时给字段增加索引</li><li>创建完毕后增加索引</li></ol><p>显示所有的索引信息：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">SHOW </span><span style="color:#569CD6;">INDEX</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>添加一个索引：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">ALTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> student</span></span>
<span class="line"><span style="color:#569CD6;">ADD</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FULLTEXT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INDEX</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`studentname`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`studentname`</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>不使用全文索引，检查 SQL 语句：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">EXPLAIN </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student;</span></span>
<span class="line"></span></code></pre></div><p>使用全文索引，检查 SQL 执行：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">EXPLAIN </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> student</span></span>
<span class="line"><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> MATCH(studentname) AGAINST(</span><span style="color:#CE9178;">&#39;张&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><h3 id="73-测试索引性能" tabindex="-1"><a class="header-anchor" href="#73-测试索引性能" aria-hidden="true">#</a> 7.3 测试索引性能</h3><p>创建下面的表：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> `</span><span style="color:#DCDCAA;">app_user</span><span style="color:#D4D4D4;">` (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">BIGINT</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;"> ) UNSIGNED </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;"> ) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;用户昵称&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;"> ) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;用户邮箱&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`phone`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;"> ) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;手机号&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`gender`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TINYINT</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;"> ) UNSIGNED </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;0&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;性别（0:男；1：女）&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`password`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;"> ) </span><span style="color:#569CD6;">NOT NULL</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;密码&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`age`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TINYINT</span><span style="color:#D4D4D4;"> ( </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;"> ) </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;0&#39;</span><span style="color:#D4D4D4;"> COMMENT </span><span style="color:#CE9178;">&#39;年龄&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`create_time`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">datetime</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`update_time`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TIMESTAMP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">NULL</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CURRENT_TIMESTAMP </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">UPDATE</span><span style="color:#D4D4D4;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;"> ( </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> ) </span></span>
<span class="line"><span style="color:#D4D4D4;">) ENGINE = INNODB </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> CHARSET = utf8mb4 COMMENT = </span><span style="color:#CE9178;">&#39;app用户表&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后插入 1,000,000 条 数据：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 开启函数权限（重启后会失效）</span></span>
<span class="line"><span style="color:#569CD6;">set</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">global</span><span style="color:#D4D4D4;"> log_bin_trust_function_creators = </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">-- 创建 mock_data() 函数</span></span>
<span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FUNCTION</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">IF</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">EXISTS</span><span style="color:#D4D4D4;"> mock_data;</span></span>
<span class="line"><span style="color:#D4D4D4;">DELIMITER $$</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FUNCTION</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">mock_data</span><span style="color:#D4D4D4;"> () </span><span style="color:#569CD6;">RETURNS</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span></span>
<span class="line"><span style="color:#569CD6;">BEGIN</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">DECLARE</span><span style="color:#D4D4D4;"> num </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">1000000</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">DECLARE</span><span style="color:#D4D4D4;"> i </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DEFAULT</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">WHILE</span><span style="color:#D4D4D4;"> i &lt; num DO</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`app_user`</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`phone`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`gender`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`password`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">`age`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">VALUES</span><span style="color:#D4D4D4;"> (</span><span style="color:#DCDCAA;">CONCAT</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;用户&#39;</span><span style="color:#D4D4D4;">, i), </span><span style="color:#CE9178;">&#39;24736743@qq.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#DCDCAA;">CONCAT</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;18&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#DCDCAA;">FLOOR</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">RAND</span><span style="color:#D4D4D4;">()*(</span><span style="color:#B5CEA8;">999999999</span><span style="color:#D4D4D4;">-</span><span style="color:#B5CEA8;">100000000</span><span style="color:#D4D4D4;">)+ </span><span style="color:#B5CEA8;">100000000</span><span style="color:#D4D4D4;">)), </span><span style="color:#DCDCAA;">FLOOR</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">RAND</span><span style="color:#D4D4D4;">()* </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">), UUID(), </span><span style="color:#DCDCAA;">FLOOR</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">RAND</span><span style="color:#D4D4D4;">()* </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> i = i + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">END</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">WHILE</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">RETURN</span><span style="color:#D4D4D4;"> i;</span></span>
<span class="line"><span style="color:#569CD6;">END</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">-- 执行操作</span></span>
<span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> mock_data();</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先我们查询这个数据：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> app_user </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;用户9999&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>执行用时达到了 1 秒。</p><p>我们解释上面的 SQL 执行：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">EXPLAIN </span><span style="color:#569CD6;">SELECT</span><span style="color:#D4D4D4;"> * </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> app_user </span><span style="color:#569CD6;">WHERE</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&#39;用户9999&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>其 <code>row</code> 列数字达到了 992357，也就是说数据库查找了 992357 条数据才找到我们的数据。</p><p>添加索引：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INDEX</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">id_app_user</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> app_user(</span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>再去执行刚才的索引，速度提升明显。</p><p>索引在小数据量的时候，用处不大，但是在大数据量时区别明显。</p><h3 id="74-索引原则" tabindex="-1"><a class="header-anchor" href="#74-索引原则" aria-hidden="true">#</a> 7.4 索引原则</h3><p>基本原则：</p><ul><li>索引不是越多越好</li><li>不要对经常变动的数据加索引</li><li>小数据量的表不需要加索引</li><li>索引一般作用在常用来查询的字段上</li></ul><p>不同索引类型的区别：</p><ul><li>Hash 索引：查询单条快，范围查询慢</li><li>BTree 索引：B+ 树，层数越多，数据量指数级增长</li></ul><p>InnoDB 默认的索引类型是 BTree。</p><p>不同的存储引擎支持的索引类型也不一样：</p><ul><li>InnoDB 支持事务，支持行级别锁定，支持 B-tree、Full-text 等索引，不支持 Hash 索引</li><li>MyISAM 不支持事务，支持表级别锁定，支持 B-tree、Full-text 等索引，不支持 Hash 索引</li><li>Memory 不支持事务，支持表级别锁定，支持 B-tree、Hash 等索引，不支持 Full-text 索引</li><li>NDB 支持事务，支持行级别锁定，支持 Hash 索引，不支持 B-tree、Full-text 等索引</li><li>Archive 不支持事务，支持表级别锁定，不支持 B-tree、Hash、Full-text 等索引</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>推荐阅读：<a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener noreferrer">MySQL 索引原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>。</p></div><h2 id="8-权限管理和数据库备份" tabindex="-1"><a class="header-anchor" href="#8-权限管理和数据库备份" aria-hidden="true">#</a> 8. 权限管理和数据库备份</h2><h3 id="81-用户管理" tabindex="-1"><a class="header-anchor" href="#81-用户管理" aria-hidden="true">#</a> 8.1 用户管理</h3><p>推荐使用数据库管理软件进行可视化管理，因为用户管理很少需要被使用，而且需要严格的操作。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">-- 创建用户并设定密码</span></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">USER</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Alex</span><span style="color:#D4D4D4;"> IDENTIFIED </span><span style="color:#569CD6;">BY</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 修改当前用户密码</span></span>
<span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">PASSWORD</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">PASSWORD</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 修改指定用户的密码</span></span>
<span class="line"><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">PASSWORD</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">FOR</span><span style="color:#D4D4D4;"> Alex = </span><span style="color:#569CD6;">PASSWORD</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;abcdefg&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 重命名用户</span></span>
<span class="line"><span style="color:#D4D4D4;">RENAME USER Alex </span><span style="color:#569CD6;">TO</span><span style="color:#D4D4D4;"> Bob;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">-- 用户授权，授予全部权限给每个表，格式为 库.表</span></span>
<span class="line"><span style="color:#569CD6;">GRANT</span><span style="color:#D4D4D4;"> ALL PRIVILEGES </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> *.* </span><span style="color:#569CD6;">TO</span><span style="color:#D4D4D4;"> Alex;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果我们给一个用户授权的内容是 <code>ALL PRIVILEGES</code>，那么这个用户拥有除了 <code>GRANT</code> 以外的全部权限，如果需要等同于 <code>root</code> 的权限，可以使用下面的 SQL：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">GRANT</span><span style="color:#D4D4D4;"> ALL PRIVILEGES </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> *.* </span><span style="color:#569CD6;">TO</span><span style="color:#D4D4D4;"> Alex </span><span style="color:#569CD6;">WITH</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">GRANT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">OPTION</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span></code></pre></div><p>查询权限：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">SHOW GRANTS </span><span style="color:#569CD6;">FOR</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">admin</span><span style="color:#D4D4D4;">@localhost;</span></span>
<span class="line"></span></code></pre></div><p>如果后面不加域，默认查询 <code>user@%</code> 用户。</p><p>撤销权限：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">REVOKE</span><span style="color:#D4D4D4;"> ALL PRIVILEGES </span><span style="color:#569CD6;">ON</span><span style="color:#D4D4D4;"> *.* </span><span style="color:#569CD6;">FROM</span><span style="color:#D4D4D4;"> Alex;</span></span>
<span class="line"></span></code></pre></div><p>删除用户：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">DROP</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">USER</span><span style="color:#D4D4D4;"> Alex;</span></span>
<span class="line"></span></code></pre></div><h3 id="82-数据库备份" tabindex="-1"><a class="header-anchor" href="#82-数据库备份" aria-hidden="true">#</a> 8.2 数据库备份</h3><p>为什么要备份？</p><ul><li>保证重要的数据不丢失</li><li>数据转移</li></ul><p>MySQL 数据库备份 的方式：</p><ul><li>拷贝物理文件</li><li>可视化工具中导出</li><li>使用命令行</li></ul><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">mysqldump</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-hlocalhost</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-uroot</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-pxxxx</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">school</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">student</span><span style="color:#D4D4D4;"> &gt; </span><span style="color:#CE9178;">dump.sql</span></span>
<span class="line"></span></code></pre></div><p>如果需要备份多张表，用空格分隔多张表。</p><p>导入数据，先登录，然后在命令控制台输入：</p><div class="language-sql" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">USE</span><span style="color:#D4D4D4;"> school;</span></span>
<span class="line"><span style="color:#D4D4D4;">SOURCE dump.sql;</span></span>
<span class="line"></span></code></pre></div><p>或者使用命令行：</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">mysql</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-uroot</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">-pxxxx</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">school</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#CE9178;">dump.sql</span></span>
<span class="line"></span></code></pre></div><h2 id="9-规范数据库设计" tabindex="-1"><a class="header-anchor" href="#9-规范数据库设计" aria-hidden="true">#</a> 9. 规范数据库设计</h2><h3 id="91-为什么设计数据库" tabindex="-1"><a class="header-anchor" href="#91-为什么设计数据库" aria-hidden="true">#</a> 9.1 为什么设计数据库</h3><p>当数据库比较复杂的时候，我们需要对数据库进行设计。</p><p>糟糕的数据库设计：</p><ul><li>数据冗余，浪费空间</li><li>数据插入、删除都会麻烦（不使用物理外键）</li><li>程序性能差</li></ul><p>良好的数据库设计：</p><ul><li>节省内存空间</li><li>保证数据的完整性</li><li>方便开发系统</li></ul><p>软件开发中，数据库设计</p><ul><li>分析需求：分析业务需求和需要处理的数据库的需求</li><li>概要设计：设计关系图、E-R 图</li></ul><p>设计数据库的步骤（个人博客）：</p><ul><li>收集信息，分析需求 <ul><li>用户表（用户登录，个人信息，写博客，创建分类）</li><li>分类表（文章分类，创建者）</li><li>文章表（文章的信息）</li><li>友链表（友链信息）</li><li>自定义表（系统信息，某个关键字，或者一些主字段）</li></ul></li><li>标识实体</li><li>标识实体之间的关系 <ul><li>多个实体之间的关系</li><li>没有关联的表</li></ul></li></ul><p>场景举例：粉丝查询</p><ul><li>查询粉丝的数量</li><li>查询粉丝的具体用户 ID</li></ul><p>建立中间表 <code>user_follow</code>：</p><table><thead><tr><th>字段</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td><code>id</code></td><td>int</td><td>主键</td></tr><tr><td><code>user_id</code></td><td>int</td><td>被关注者</td></tr><tr><td><code>follow_id</code></td><td>int</td><td>关注者</td></tr></tbody></table><p>PS：可以使用一些前端框架，整合数据库和后端：</p><ul><li>Ant Design Pro</li><li>ElementUI</li></ul><h3 id="92-三大范式" tabindex="-1"><a class="header-anchor" href="#92-三大范式" aria-hidden="true">#</a> 9.2 三大范式</h3><p>为什么需要数据规范化？</p><ul><li>信息重复</li><li>更新异常</li><li>插入异常 <ul><li>无法正常显示信息</li></ul></li><li>删除异常 <ul><li>丢失有效信息</li></ul></li></ul><p>三大范式：</p><ul><li>第一范式（1NF）：每一列都是原子项（字段不可再分）</li><li>第二范式（2NF）：在第一范式的基础上消除非主属性对主码的部分函数依赖（每张表只做一件事情）</li><li>第三范式（3NF）：在第二范式基础上消除传递依赖（数据表中的每一列数据都和主键直接相关）</li></ul><p>规范不是越高越好：</p><ul><li>成本和用户体验问题，性能往往更重要</li><li>阿里规范：关联查询不得超过三张表</li><li>故意给一些表增加冗余字段（可以避免多表查询）</li></ul><h2 id="10-jdbc" tabindex="-1"><a class="header-anchor" href="#10-jdbc" aria-hidden="true">#</a> 10. JDBC</h2><h3 id="101-数据库驱动" tabindex="-1"><a class="header-anchor" href="#101-数据库驱动" aria-hidden="true">#</a> 10.1 数据库驱动</h3><p>Sun 公司为了简化数据库的开发操作，提供了一个 Java 操作数据库的规范，称为 JDBC，这些规范由具体的数据局厂商去实现。</p><p>对于开发人员来说，我们只需要掌握 JDBC 接口操作即可。</p><p>除了需要 JDBC 的包，我们还需要 MySQL 数据库驱动包：<code>mysql-connector-java-5.1.47.jar</code>。</p><h3 id="102-第一个-jdbc-程序" tabindex="-1"><a class="header-anchor" href="#102-第一个-jdbc-程序" aria-hidden="true">#</a> 10.2 第一个 JDBC 程序</h3><p>我们首先创建一个数据库：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATABASE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">JDBCStudy</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">CHARACTER</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">SET</span><span style="color:#D4D4D4;"> utf8 </span><span style="color:#569CD6;">COLLATE</span><span style="color:#D4D4D4;"> utf8_general_ci;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">USE</span><span style="color:#D4D4D4;"> jdbcstudy;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">CREATE</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">TABLE</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">users</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`id`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">INT</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">PRIMARY KEY</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`name`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`password`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">40</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`email`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">VARCHAR</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`birthday`</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">DATE</span></span>
<span class="line"><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">INSERT INTO</span><span style="color:#D4D4D4;"> users </span><span style="color:#569CD6;">VALUES</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;zhangsan&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;123456&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;zs@sina.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1980-12-04&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;lisi&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;12345123126&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;ls@sina.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1982-12-04&#39;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;kkww&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1ed23456&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;kw@sina.com&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;1999-12-04&#39;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>按照如下的步骤创建 JDBC 项目：</p><ol><li>创建一个 Java 项目</li><li>复制数据库驱动 <code>.jar</code> 包到 <code>@/lib/</code> 文件夹下，然后导入到库</li><li>编写代码测试</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Test</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">[] </span><span style="color:#9CDCFE;">args</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ClassNotFoundException</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 1. 加载驱动</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">Class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;com.mysql.jdbc.Driver&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">url</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;jdbc:mysql://localhost:3306/jdbcstudy?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">user</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;root&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">password</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;xxxxxx&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 2. 获取连接</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">DriverManager</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">(url, user, password);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 3. 创建语句</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Statement</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">stmt</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createStatement</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sql</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;select * from users&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 4. 执行 SQL 语句</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">ResultSet</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">stmt</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">executeQuery</span><span style="color:#D4D4D4;">(sql);</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 5. 循环判断是否有下一行</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">next</span><span style="color:#D4D4D4;">()) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;--------------------&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObject</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;id&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObject</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;name&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObject</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;password&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObject</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;email&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getObject</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;birthday&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// 6. 关闭资源</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">stmt</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>DriverManager</code> 原始的写法如下，但是使用反射可以直接注册，如果再写下面的语句相当于被注册了两次。</p><div class="language-java" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#9CDCFE;">DriverManager</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">registerDriver</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> com.</span><span style="color:#9CDCFE;">mysql</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">jdbc</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Driver</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"></span></code></pre></div><p>数据库的基本设置可以使用连接对象设置：</p><div class="language-java" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rollback</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">commit</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setAutoCommit</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span></code></pre></div><p>语句对象：</p><table><thead><tr><th>方法</th><th>功能</th></tr></thead><tbody><tr><td><code>stmt.execute()</code></td><td>执行任何 SQL</td></tr><tr><td><code>stmt.executeQuery()</code></td><td>执行查询操作</td></tr><tr><td><code>stmt.executeUpdate()</code></td><td>更新、插入或删除操作，返回受到影响的行数</td></tr><tr><td><code>stmt.executeBatch()</code></td><td>执行多个 SQL</td></tr></tbody></table><p>结果集对象：</p><table><thead><tr><th>方法</th></tr></thead><tbody><tr><td><code>rs.next()</code></td></tr><tr><td><code>rs.getObject()</code></td></tr><tr><td><code>rs.getInt()</code></td></tr><tr><td><code>rs.getFloat()</code></td></tr><tr><td><code>rs.getDate()</code></td></tr><tr><td><code>rs.getString()</code></td></tr></tbody></table><h3 id="103-封装-jdbc-连接" tabindex="-1"><a class="header-anchor" href="#103-封装-jdbc-连接" aria-hidden="true">#</a> 10.3 封装 JDBC 连接</h3><p>新建 <code>db.properties</code> 文件：</p><div class="language-properties" data-ext="properties"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">driver</span><span style="color:#D4D4D4;">=com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#569CD6;">url</span><span style="color:#D4D4D4;">=jdbc:mysql://localhost:3306/jdbcstudy?</span><span style="color:#569CD6;">useUnicode</span><span style="color:#D4D4D4;">=true&amp;</span><span style="color:#569CD6;">characterEncoding</span><span style="color:#D4D4D4;">=utf-8&amp;</span><span style="color:#569CD6;">useSSL</span><span style="color:#D4D4D4;">=true</span></span>
<span class="line"><span style="color:#569CD6;">username</span><span style="color:#D4D4D4;">=root</span></span>
<span class="line"><span style="color:#569CD6;">password</span><span style="color:#D4D4D4;">=xxxxx</span></span>
<span class="line"></span></code></pre></div><p>新建类 <code>JdbcUtils.java</code> 然后编写：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">JdbcUtils</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">driver</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">url</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">username</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">password</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">in</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getClassLoader</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">getResourceAsStream</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;db.properties&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Properties</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(in);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">            driver = </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getProperty</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;driver&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            url = </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getProperty</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;url&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            username = </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getProperty</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;username&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            password = </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getProperty</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;password&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">Class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">forName</span><span style="color:#D4D4D4;">(driver);</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">ClassNotFoundException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">DriverManager</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">(url, username, password);</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">release</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">Statement</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">ResultSet</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (rs != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (st != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (conn != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更新数据：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Test</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">[] </span><span style="color:#9CDCFE;">args</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Statement</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">stmt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">ResultSet</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            conn = </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            stmt = </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createStatement</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sql</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;insert into users values (4, &#39;Alex&#39;, &#39;123&#39;, &#39;yali@alexsun.top&#39;, &#39;2002-06-05&#39;)&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">stmt</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">executeUpdate</span><span style="color:#D4D4D4;">(sql);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (i &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;插入成功&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;插入失败&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">release</span><span style="color:#D4D4D4;">(conn, stmt, rs);</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="104-解决-sql-注入问题" tabindex="-1"><a class="header-anchor" href="#104-解决-sql-注入问题" aria-hidden="true">#</a> 10.4 解决 SQL 注入问题</h3><p><code>PreparedStatement</code> 可以防止 SQL 注入，并且拥有更高的效率。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Test</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">[] </span><span style="color:#9CDCFE;">args</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">PreparedStatement</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">pstmt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">ResultSet</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            conn = </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            pstmt = </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">prepareStatement</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;insert into users values (?,?,?,?,?)&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setInt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setString</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;1&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setString</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;1&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setString</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;1&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setDate</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Date</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> java.</span><span style="color:#9CDCFE;">util</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Date</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">getTime</span><span style="color:#D4D4D4;">()));</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">i</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">st</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">executeUpdate</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (i &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;插入成功&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">System</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">out</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;插入失败&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">release</span><span style="color:#D4D4D4;">(conn, pstmt, rs);</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="105-jdbc-事务" tabindex="-1"><a class="header-anchor" href="#105-jdbc-事务" aria-hidden="true">#</a> 10.5 JDBC 事务</h3><p>JDBC 实现事务：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Test</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">[] </span><span style="color:#9CDCFE;">args</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">PreparedStatement</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">pstmt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#4EC9B0;">ResultSet</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">rs</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            conn = </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setAutoCommit</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sql1</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;UPDATE account SET money=money-500 WHERE `name` = &#39;A&#39;&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sql2</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;UPDATE account SET money=money+500 WHERE `name` = &#39;B&#39;&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">            pstmt1 = </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">prepareStatement</span><span style="color:#D4D4D4;">(sql1);</span></span>
<span class="line"><span style="color:#D4D4D4;">            pstmt2 = </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">prepareStatement</span><span style="color:#D4D4D4;">(sql2);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">pstmt1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">executeUpdate</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">pstmt2</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">executeUpdate</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">commit</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">conn</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">rollback</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">SQLException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e1</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#9CDCFE;">e1</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            }</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">JdbcUtils</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">release</span><span style="color:#D4D4D4;">(conn, pstmt, rs);</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不写 <code>conn.rollback();</code> 事务也会被回滚。</p><h3 id="106-数据库连接池" tabindex="-1"><a class="header-anchor" href="#106-数据库连接池" aria-hidden="true">#</a> 10.6 数据库连接池</h3><p>原始的数据库连接过程：</p><ol><li>建立数据库连接</li><li>执行完毕</li><li>释放</li></ol><p>连接 —— 释放过程十分浪费时间。池化技术是准备一些预先的资源，过来就连接预先准备好的。</p><p>几个常用值：</p><ul><li>常用连接数</li><li>最小连接数</li><li>最大连接数</li><li>超时时间</li></ul><p>如果超过了最大连接数就只能排队等待，如果一个连接超时就会抛出错误并结束连接。</p><p>如果需要编写连接池，需要实现 <code>DataSource</code> 接口。</p><p>常见的开源数据源实现：</p><ul><li>DBCP</li><li>C3P0</li><li>Druid</li></ul><p>使用了数据库连接池之后，我们就不需要编写连接数据库的代码。</p><h3 id="107-dbcp-连接池" tabindex="-1"><a class="header-anchor" href="#107-dbcp-连接池" aria-hidden="true">#</a> 10.7 DBCP 连接池</h3><p>需要下面的 <code>.jar</code> 包支持：</p><ul><li><code>commons-dbcp-1.4.jar</code></li><li><code>commons-pool-1.6.jar</code></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> org.apache.commons.dbcp.BasicDataSourceFactory;</span></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> java.sql.*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">class</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">JdbcUtilsDBCP</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">DataSource</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">dataSource</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">in</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">JdbcUtilsDBCP</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">class</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getClassLoader</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">getResourceAsStream</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;db_dbcp.properties&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Properties</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">props</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">load</span><span style="color:#D4D4D4;">(in);</span></span>
<span class="line"><span style="color:#D4D4D4;">            dataSource = </span><span style="color:#9CDCFE;">BasicDataSourceFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createDataSource</span><span style="color:#D4D4D4;">(props);</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">ClassNotFoundException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">printStackTrace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Connection</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">dataSource</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getConnection</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">static</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">release</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">dataSource</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">destroy</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>C3P0 类似，可以参考文档进行实现。</p><p>后续可以学习：</p><ul><li>Druid</li><li>Apache 项目的其他软件</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/Sun-ZhenXing/vuepress-database-notes//edit/main/docs/mysql/basic/index.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1006925066@qq.com">Sun-ZhenXing</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/vuepress-database-notes/assets/app-Y4KcrCk8.js" defer></script>
  </body>
</html>
